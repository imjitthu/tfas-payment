pipeline { 

    agent any
    options { disableConcurrentBuilds() }

    stages ('Setup Roboshop Application') { 
        stage ('Installing paymant Server') { 
            steps { 
            withCredentials([aws(accessKeyVariable: 'AWS_ACCESS_KEY_ID', credentialsId: 'awskey', secretKeyVariable: 'AWS_SECRET_ACCESS_KEY')]) {
                    git 'https://github.com/imjitthu/tfas-payment.git'
                    sh 'terraform init'
                    sh 'terraform plan'
                    } 
            ansiblePlaybook credentialsId: 'DevOps321', installation: 'ansibletool', inventory: 'paymant_inv', playbook: 'paymant.yml'
                } 
            } 
        } 
    } 